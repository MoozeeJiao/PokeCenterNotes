# 遗留系统重构实战

# 遗留项目的挑战

遗留项目: 已经存在的、难以维护、难以扩展的项目

* 老旧
* 庞大
* 继承而来
* 文档不完善

遗留代码

* 没有测试（补测试很难；代码中硬编码）
* 不灵活（实现新功能或修改牵一发而动全身）
* 技术债务（临时的解决方案就是债务，需要偿还）

遗留基础设施

* 开发环境搭建耗时
* 过时的依赖
* 异构环境（生产与测试不同步）

遗留文化

* 害怕变化（更改的风险与收益）
* 知识仓库（团队内部沟通）

# 找到起点

## 探索性重构

对遗留代码的恐惧来自于不了解的部分。通过对一些方法的移动、添加新接口、添加注释来增加对代码的理解。同时提高代码的可读性。

## 代码质量指标

克服对重构失去动力或一时上头孤注一掷，将指标作为改进目标。并且帮助发现下一个重构对象是什么。

## 收集遗留项目的有用数据

### bug和编码标准违例

* FindBugs 检查字节码bug
* PMD 检查源代码bug
* Checkstyle 检查源代码编码风格

### 性能

* 测试环境性能测试
* 生产环境性能监控（fluentd->es->kibana）

### 任务计时

* 搭建开发环境时间
* 发布部署项目时间
* 修复一个bug时间（团队成员之间沟通）

### 常用文件

git上统计最经常被修改的文件

## 代码静态分析工具审查代码库

## 使用jenkins持续审查

1. 提交变更
2. 触发构建
3. 构建项目并运行审查工具
4. 给出反馈
5. 检查项目状态